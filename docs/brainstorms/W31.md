# Wave 31 — UI Layout, Branding & Interaction Polish

## Origin

After hands-on testing of the Wave 30 UI, several friction points emerged:

1. The Hippocampus logo appears in both the navbar and sidebar — redundant.
2. In the navbar header, "Team Memory" (small) sits above "Hippocampus" (large) — the product name should lead.
3. The logo PNG looks dark against the dark background — needs a brightness boost.
4. The landing page displays a "Wave 25 Visual System" badge — internal numbering that shouldn't be user-facing.
5. The import row permanently collapses during import with no way to re-expand it — should be a toggleable accordion.
6. After import completes, rule cards and rule graph nodes appear before the user initiates the sleep cycle — confusing because rules are generated during consolidation. They should be gated behind sleep cycle initiation.

## Objective

Clean up navbar/sidebar branding, remove internal wave numbering from the landing page, make the import row a toggleable accordion that stays collapsed after import, and gate rule visibility in the graph and feed behind sleep cycle initiation.

## Scope

| In scope                                               | Out of scope                             |
| ------------------------------------------------------ | ---------------------------------------- |
| Remove sidebar logo                                    | 3D graph node spawn animation tuning     |
| Reorder navbar header text                             | Backend consolidation/import API changes |
| CSS brightness treatment on logo                       | New logo asset creation                  |
| Remove landing page wave badge                         | Landing page redesign                    |
| Import row accordion toggle                            | Sleep cycle API changes                  |
| Rule gating in graph + feed behind consolidation phase | Card animation timing (Wave 32)          |

## Decision Log

| Decision              | Choice                                                                                        | Rationale                                                                                             | Affects        |
| --------------------- | --------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------- | -------------- |
| Logo placement        | Keep in navbar only, remove from sidebar                                                      | User preference; avoids duplication                                                                   | WP-102, WP-103 |
| Header text order     | Hippocampus (large) on top, Team Memory (small) below                                         | User preference — product name leads                                                                  | WP-103         |
| Logo treatment        | CSS brightness filter + white drop-shadow                                                     | No new asset needed; reversible; CSS-only                                                             | WP-103         |
| Accordion approach    | Internal `userExpanded` state in RepoSelector; parent sends `collapsed` signal                | Clean file isolation; self-contained toggle logic                                                     | WP-105         |
| Collapsed persistence | Change `collapsed` prop to `PHASE_ORDER[phase] >= PHASE_ORDER.importing && phase !== "error"` | Keeps collapsed across all post-idle phases; user can still toggle open                               | WP-106         |
| Rule gating           | Filter `rule-*` nodes from `displayNodes`/`displayEdges` until `phase >= consolidating`       | Simplest approach; no API changes needed; feed already clean since `consolidationEvents` starts empty | WP-106         |
| Landing hero offset   | Move landing page card from center to top-aligned with responsive top padding                  | Improves above-the-fold composition and visual balance after badge removal                            | WP-109         |

---

## Wave 31 — Layout, Branding & Interaction Polish

> Remove logo duplication, reorder header text, brighten logo, strip wave badge, add import accordion toggle, and gate rules behind sleep cycle.

### Required Skills (Wave 31)

- `vercel-react-best-practices` — React component patterns, state management
- `next-best-practices` — Next.js Image component usage
- `framer-motion` — AnimatePresence, accordion animation

---

### WP-102: Remove logo from sidebar

- **Priority:** P1
- **Dependencies:** none
- **Files:** `components/layout/Sidebar.tsx`
- **Required Skills:** none additional
- **Objective:** The sidebar no longer renders the Hippocampus logo or its "Hippocampus" text label.
- **Implementation notes:**
  - Remove the `Image` import from `next/image` (line 1)
  - Remove the entire logo container div (lines 12-21): the `<div className="mb-4 flex items-center gap-2 border-b border-zinc-800 px-3 pb-3">` block containing the `<Image>` and `<p>Hippocampus</p>`
  - The `<nav>` sections below remain unchanged
  - The `p-4` padding on the `<aside>` provides adequate top spacing without the logo block
- **Acceptance criteria:**
  - [ ] Sidebar renders without any logo image or "Hippocampus" text
  - [ ] Navigation links (Dashboard, Episodes, Sleep Cycle) still render correctly
  - [ ] `npx tsc --noEmit` passes
- **Evidence:** Visual screenshot of sidebar without logo

---

### WP-103: Swap header text order and brighten logo

- **Priority:** P1
- **Dependencies:** none
- **Files:** `components/layout/Header.tsx`
- **Required Skills:** none additional
- **Objective:** Navbar shows "Hippocampus" (large) on top, "Team Memory" (small) below, and the logo appears brighter with a subtle white glow.
- **Implementation notes:**
  - In `Header.tsx` lines 22-25, swap the element order within the `<div className="space-y-1">`:
    - Move `<h1 className="text-xl font-semibold text-zinc-100">Hippocampus</h1>` ABOVE the `<p>` tag
    - Move `<p className="text-sm text-zinc-400">Team Memory</p>` BELOW the `<h1>` tag
    - Keep all existing class names and sizing unchanged
  - On the `<Image>` element (line 20), add CSS classes to brighten the logo:
    - Add `brightness-125` to increase overall luminance
    - Add `drop-shadow-[0_0_4px_rgba(255,255,255,0.4)]` for a subtle white glow outline
    - Final className: `"h-8 w-8 rounded-full brightness-125 drop-shadow-[0_0_4px_rgba(255,255,255,0.4)]"`
  - If Tailwind doesn't include `brightness-125` by default, use arbitrary value: `[filter:brightness(1.25)]`
- **Acceptance criteria:**
  - [ ] "Hippocampus" (text-xl, font-semibold) renders on top in the header
  - [ ] "Team Memory" (text-sm, text-zinc-400) renders below
  - [ ] Logo image appears brighter with a visible but subtle white glow
  - [ ] `npx tsc --noEmit` passes
- **Evidence:** Visual screenshot comparing before/after header

---

### WP-104: Remove wave numbering badge from landing page

- **Priority:** P2
- **Dependencies:** none
- **Files:** `app/page.tsx`
- **Required Skills:** none additional
- **Objective:** The landing page no longer displays the "Wave 25 Visual System" badge.
- **Implementation notes:**
  - Remove the `Badge` import from line 4 (verify it's not used elsewhere in the file — it is not)
  - Remove lines 24-26: the entire `<Badge className="mx-auto w-fit ...">Wave 25 Visual System</Badge>` element
  - The `CardHeader` `space-y-5` spacing will naturally collapse — verify the logo and title still look centered
  - Keep all other landing page elements (logo, title, subtitle, login button) unchanged
- **Acceptance criteria:**
  - [ ] No "Wave 25 Visual System" badge appears on the landing page
  - [ ] Landing page layout remains centered and visually balanced
  - [ ] `npx tsc --noEmit` passes
- **Evidence:** Visual screenshot of landing page without badge

---

### WP-105: Convert import row collapse to accordion toggle

- **Priority:** P1
- **Dependencies:** none
- **Files:** `components/onboarding/RepoSelector.tsx`
- **Required Skills:**
  - `framer-motion` (accordion animation)
- **Objective:** The import row collapses when import starts but can be re-expanded by the user via a toggle button. It stays collapsed by default after import completes.
- **Implementation notes:**
  - **Add internal toggle state:**
    - Add `const [userExpanded, setUserExpanded] = useState(false)` (import `useEffect` too)
    - Track `collapsed` prop changes with `useEffect` — when `collapsed` transitions to `true`, reset `userExpanded` to `false`:
      ```tsx
      useEffect(() => {
        if (collapsed) {
          setUserExpanded(false);
        }
      }, [collapsed]);
      ```
    - Compute visibility: `const showExpanded = !collapsed || userExpanded`
    - Use `showExpanded` in the AnimatePresence condition (line 92): render expanded content when `showExpanded` is true
  - **Restructure collapsed view as accordion header (lines 92-108):**
    - Always show the collapsed indicator bar when `collapsed` prop is `true`
    - Import `ChevronDown` from `lucide-react`
    - Make the collapsed bar clickable: wrap content in a `<button>` or add `onClick={() => setUserExpanded(prev => !prev)}` to the container
    - Add a `ChevronDown` icon on the right side, rotated 180deg when `userExpanded` is true:
      ```tsx
      <ChevronDown
        className={`h-4 w-4 text-zinc-400 transition-transform ${userExpanded ? 'rotate-180' : ''}`}
      />
      ```
    - When `userExpanded` is true AND `collapsed` is true, render both the collapsed header bar AND the expanded repo selector cards below it using `AnimatePresence`
  - **Do NOT modify OnboardingFlow.tsx in this issue** — the `collapsed` prop logic is adjusted in WP-106
- **Acceptance criteria:**
  - [ ] Collapsed bar shows a clickable toggle (chevron icon)
  - [ ] Clicking toggle expands to show the full repo selector cards below the compact bar
  - [ ] Clicking toggle again collapses back to just the compact bar
  - [ ] Animation between states is smooth (spring transition on layout)
  - [ ] `npx tsc --noEmit` passes
- **Evidence:** Screen recording of toggle expand/collapse behavior

---

### WP-106: Gate rule cards and graph nodes behind sleep cycle initiation

- **Priority:** P1
- **Dependencies:** WP-105
- **Files:** `components/onboarding/OnboardingFlow.tsx`
- **Required Skills:** none additional
- **Objective:** Rule nodes and rule-related edges do not appear in the 3D graph until the consolidation (sleep cycle) phase begins. Import row stays collapsed after import completes.
- **Implementation notes:**
  - **Keep import row collapsed after import completes:**
    - Line 923: Change `collapsed={phase === "importing"}` to:
      ```tsx
      collapsed={PHASE_ORDER[phase] >= PHASE_ORDER.importing && phase !== "error"}
      ```
    - This keeps RepoSelector collapsed during: importing, ready, consolidating, consolidated, distributing, distributed
    - NOT collapsed during: idle, error
    - Combined with WP-105's accordion toggle, the user can still manually expand when needed
  - **Filter rule nodes from displayNodes (lines 871-877):**
    ```tsx
    const displayNodes = useMemo(() => {
      let nodes = visibleNodeIds
        ? graph.nodes.filter((node) => visibleNodeIds.has(node.id))
        : graph.nodes;
      if (PHASE_ORDER[phase] < PHASE_ORDER.consolidating) {
        nodes = nodes.filter((node) => !node.id.startsWith('rule-'));
      }
      return nodes;
    }, [graph.nodes, phase, visibleNodeIds]);
    ```
  - **Filter rule edges from displayEdges (lines 879-885):**
    ```tsx
    const displayEdges = useMemo(() => {
      let edges = visibleNodeIds
        ? graph.edges.filter(
            (edge) =>
              visibleNodeIds.has(edge.source) && visibleNodeIds.has(edge.target)
          )
        : graph.edges;
      if (PHASE_ORDER[phase] < PHASE_ORDER.consolidating) {
        const ruleNodeIds = new Set(
          graph.nodes.filter((n) => n.id.startsWith('rule-')).map((n) => n.id)
        );
        edges = edges.filter(
          (edge) =>
            !ruleNodeIds.has(edge.source) && !ruleNodeIds.has(edge.target)
        );
      }
      return edges;
    }, [graph.edges, graph.nodes, phase, visibleNodeIds]);
    ```
  - **Feed is already fine:** `consolidationEvents` starts empty and only populates during consolidation streaming, so rule_promoted cards won't appear in the feed before sleep cycle
  - **Do NOT touch RepoSelector.tsx** — that was handled in WP-105
- **Acceptance criteria:**
  - [ ] After import completes, no rule nodes appear in the 3D graph
  - [ ] After import completes, no rule cards appear in the feed
  - [ ] After sleep cycle starts, rule nodes progressively appear as `rule_promoted` events stream
  - [ ] Import row stays collapsed after import completes
  - [ ] User can still toggle import row open via WP-105's accordion button
  - [ ] `npx tsc --noEmit` passes
- **Evidence:** Screen recording: import completes → no rules visible → sleep cycle starts → rules appear

---

### WP-109: Move landing hero toward top (post-wave hotfix)

- **Priority:** P2
- **Dependencies:** WP-104
- **Files:** `app/page.tsx`
- **Required Skills:** none additional
- **Objective:** The landing card is positioned closer to the top of the viewport, improving first-screen composition on desktop and mobile.
- **Implementation notes:**
  - Update the page wrapper alignment from `items-center` to `items-start`
  - Replace uniform vertical padding with responsive top padding (`pt-14 sm:pt-20 lg:pt-24`) and retain bottom padding (`pb-10`)
  - Keep all landing content and animation layers unchanged
- **Acceptance criteria:**
  - [ ] Landing card renders noticeably above vertical center on initial load
  - [ ] Layout remains centered horizontally and responsive across breakpoints
  - [ ] `npx tsc --noEmit` passes
- **Evidence:** Visual screenshot showing top-aligned landing hero

---

**Parallelism:** WP-102 + WP-103 + WP-104 — all parallel. WP-105 — parallel with above. WP-106 — sequential after WP-105 (depends on accordion support in RepoSelector). WP-109 — sequential post-wave hotfix after WP-104.

**Wave 31 exit:** `npx tsc --noEmit` passes. Visual verification of navbar, sidebar, landing page, accordion toggle, and rule gating.

**Wave 31 completion:** All issue PRs merged → exit gate passed → wave commit + tag → full sync checkpoint. Local and GitHub fully in sync before Wave 32 begins.

---

## File Ownership Matrix

| File                                       | Wave | Issue(s) |
| ------------------------------------------ | ---- | -------- |
| `components/layout/Sidebar.tsx`            | 31   | WP-102   |
| `components/layout/Header.tsx`             | 31   | WP-103   |
| `app/page.tsx`                             | 31   | WP-104, WP-109 |
| `components/onboarding/RepoSelector.tsx`   | 31   | WP-105   |
| `components/onboarding/OnboardingFlow.tsx` | 31   | WP-106   |

## Parallelism Notes

- WP-102 + WP-103 + WP-104 + WP-105: all parallel (no file overlap)
- WP-106: sequential after WP-105
- WP-109: sequential hotfix after WP-104

## Assumptions

- The existing `hippocampus-logo.png` asset is not being replaced — CSS brightness/shadow treatment is sufficient
- Tailwind CSS supports arbitrary value syntax `[filter:brightness(1.25)]` if `brightness-125` utility is not available
- Rule nodes in the graph all have IDs prefixed with `rule-`
- `lucide-react` is already installed (confirmed: used in PRGroupCard's ChevronDown)

```

---
```
